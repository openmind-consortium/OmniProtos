syntax = "proto3";
package openmind;

option csharp_namespace = "OpenMind";

import "common.proto";

service Device {
  rpc List (ListDeviceRequest) returns (stream DeviceRef);
  rpc Connect (ConnectDeviceRequest) returns (ConnectDeviceResponse);
  rpc Disconnect (DisconnectDeviceRequest) returns (DisconnectDeviceResponse);
  rpc ConfigureAccelStream (AccelControlCommand) returns (AccelControlResponse);
  rpc StreamData (AccelControlCommand) returns (stream AccelEvent);
}

message ListDeviceRequest {
  BridgeRef bridge = 1;
}

message ConnectDeviceRequest {
  DeviceRef device = 1;
}

message ConnectDeviceResponse {
  Status status = 1;
}

message DisconnectDeviceRequest {
  DeviceRef device = 1;
}

message DisconnectDeviceResponse {
  Status status = 1;
}

/**
 * NOTE(BNR): Consider making this a union with `oneof` instead of sticking an enum in there.
 */
message AccelControlCommand {
  DeviceRef device = 1;

  enum CommandType {
    UNSPECIFIED = 0;
    START = 1;
    STOP = 2;
  }
  CommandType command = 2;

  int32 sample_rate = 3;
}

message AccelControlResponse {
  Status status = 1;
}

message AccelEvent {
  int32 sample_rate = 1;
  string units = 2;
  repeated double XSamples = 3;
  repeated double YSamples = 4;
  repeated double ZSamples = 5;
}